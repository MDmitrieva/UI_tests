### UI-тесты для проекта Планнер

### Содержание

1.  [Ссылки на требования]
2.  [Предустановленные компоненты](#предустановленные-компоненты)
3.  [Установка](#установка)
4.  [Переменные окружения](#переменные-окружения)
5.  [Запуск](#запуск)
6.  [Запуск в различных средах](#запуск-в-различных-средах)
7.  [Отчётность](#отчётность)
8.  [Уведомления](#уведомления)
9.  [Правила написания новых тестов](#правила-написания-новых-тестов)
10. [Ответственные за репозиторий](#ответственные-за-репозиторий)
11. [Известные проблемы](#известные-проблемы)

### Ссылки на требования


### Предустановленные компоненты

- [Nodejs](https://nodejs.org/en/)

### Установка

```
git clone 
cd planner-ui-tests
npm i
```

### Переменные окружения

- ACCOUNTS_API_URL - урл доступа к API аккаунтс
- URL - основной урл приложения
- LOGIN - почта пользователя по умолчанию
- PASSWORD - пароль пользователя по умолчанию
- API - урл доступа к API 
- PLANNER_CLIENT_ID - ClientId для доступа к сервису

### Запуск

Открыть папку с репозиторием в терминале и запустить нужный тест из списка

```
codeceptjs run --grep "test name"
```

Либо

```
./node_modules/.bin/codeceptjs run ./features/testName.feature --debug
```
запуск всех тестов 

```
npm test
```

```
codeceptjs run
```

```
npx codeceptjs run --debug
```

##### Запуск в различных средах

пока запускается только для dev стенда


### Отчётность

Репозиторий использует allure в качестве репортера, отчеты складываются в `./output`

### Allure-ee

Для того, чтобы  отмечать метками сценарии/тесты, был написан плагин в `./src/plugins/tagPlugin.js`
Если необходимо пометить эпиком, фичей или любой другой меткой сценарий - просто добавьте в шапку
тег вида `@label=value` (Пример: `@epic=Authorization`)
```
@Feature=Authorization
Функционал: Авторизация с валидными данными

  Сценарий: Пользователь вводит валидные данные на странице авторизации и попадает в календарь
```
параметры в codecept.conf.js
`issueLabel`  - метка(по умолчанию, jira), которым будут помечены любые теги без =. Сделано для того, чтобы не писать @issue=PLN-3, а просто @PLN-3
Для отображения вложенностей смотри `https://youtu.be/YH2P-Acs0Iw?t=422`
### Уведомления

После запуска в CI, результаты теста приходят в чат planner_notifications (доступ спрашивать у поддерживающих репозиторий).
Формат оповещения содержит в себе:

- успешные тесты
- проваленные тесты(если есть)
- проваленные тесты с тегом задачи(для того, чтобы помнить, что, возможно, причина и задача по этому провалу известна)
- ссылку на отчет

### Правила написания новых тестов

1. Писать как можно более атомарные тесты - каждый тест должен выполняться отдельно от других
2. Тест требует предварительных данных/заведенных сущностей? Создавайте их через createItems.js, используя apiHelper
3. Падает тест, но уже известно, почему? Пометьте тест тегом задачи
   `Контекст: 
  Дано Я авторизован в системе через API
  И Я попадаю в просмотр календаря в масштабе "Месяц"
 
  @PLN-1123`. 
  Тогда оповещения будут напоминать, что возможно данный тест падает по известной причине, а также напомнит удалить тег и закрыть задачу, когда тест начнет проходить

4. Просите фронтов оборачивать page objects в тестовые атрибуты в формате  
    ```
    @data-testid="entity-list-table"
    ````

5. Выносите page objects для каждого теста в отдельный файл переменных в папке common

6. Повторяющиеся в разных тестах шаги выносите в файл commonSteps.js

7. Действия, которые по ходу теста можно выполнить через API, и которые уже проверяются через интерфейс в других тестах выполняйте с использованием API. Такие шаги выносите в apiSteps.js

8. Когда пишете .feature файл, постоянно заглядывайте в commonSteps.js - возможно, при правильной формулировке шагов в соответствии с шагами в этом    файле, вам придется писать меньше кода, делающего одно и то же. 

9. Каждый новый .feature файл пометить компонентом (пример, `@component=Навигация`), который покрывает тест 

### Ответственные за репозиторий

- [Мария Дмитриева](https://t.me/metalocalypse)

### Известные проблемы



